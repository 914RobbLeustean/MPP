{"ast":null,"code":"import { __decorate } from \"tslib\";\n// src/app/components/listing-detail/listing-detail.component.ts\nimport { Component, ChangeDetectionStrategy } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { takeUntil, tap, catchError } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nexport let ListingDetailComponent = class ListingDetailComponent {\n  constructor(route, router, listingService, cartService, notificationService, authService) {\n    this.route = route;\n    this.router = router;\n    this.listingService = listingService;\n    this.cartService = cartService;\n    this.notificationService = notificationService;\n    this.authService = authService;\n    this.destroy$ = new Subject();\n    this.listing = null;\n    this.selectedImage = null;\n    this.isLoading = true;\n    this.errorMessage = '';\n  }\n  ngOnInit() {\n    this.route.params.pipe(takeUntil(this.destroy$)).subscribe(params => {\n      const id = +params['id'];\n      if (!isNaN(id)) {\n        this.loadListing(id);\n      } else {\n        this.handleError('Invalid listing ID', null);\n      }\n    });\n  }\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n  loadListing(id) {\n    this.isLoading = true;\n    this.listingService.getListingById(id).pipe(takeUntil(this.destroy$), tap(listing => {\n      this.listing = listing;\n      if (listing?.photoUrls?.length) {\n        this.selectedImage = listing.mainPhotoUrl || listing.photoUrls[0];\n      }\n      this.isLoading = false;\n    }), catchError(error => {\n      this.handleError('Error loading listing details', error);\n      return [];\n    })).subscribe();\n  }\n  handleError(message, error) {\n    this.isLoading = false;\n    this.errorMessage = message;\n    this.notificationService.show(message, 'error');\n    console.error(message, error);\n    // Navigate to home after a delay\n    setTimeout(() => {\n      this.router.navigate(['/']);\n    }, 3000);\n  }\n  getImageUrl(url) {\n    if (!url) {\n      return 'assets/images/placeholder.png';\n    }\n    if (url.startsWith('/')) {\n      return `${environment.apiUrl.split('/api')[0]}${url}`;\n    }\n    return url;\n  }\n  selectImage(imageUrl) {\n    this.selectedImage = imageUrl;\n  }\n  hasDescription() {\n    return Boolean(this.listing?.description && this.listing.description.trim().length > 0);\n  }\n  getDescription() {\n    return this.listing?.description?.trim() || '';\n  }\n  getQualityClass(quality) {\n    return quality.toLowerCase().replace(/\\s+/g, '-');\n  }\n  addToCart() {\n    if (!this.listing) return;\n    try {\n      this.cartService.addToCart(this.listing);\n      this.notificationService.show(`${this.listing.title} added to cart successfully!`, 'success');\n    } catch (error) {\n      this.notificationService.show('Failed to add item to cart. Please try again.', 'error');\n    }\n  }\n  contactSeller() {\n    if (!this.listing) return;\n    if (!this.authService.isLoggedIn()) {\n      this.notificationService.show('Please login to contact the seller', 'info');\n      this.router.navigate(['/login'], {\n        queryParams: {\n          returnUrl: this.router.url\n        }\n      });\n      return;\n    }\n    this.router.navigate(['/chat', this.listing.userId]);\n  }\n  openImageModal() {\n    // TODO: Implement image modal/lightbox functionality\n    this.notificationService.show('Image zoom feature coming soon!', 'info');\n  }\n};\nListingDetailComponent = __decorate([Component({\n  selector: 'app-listing-detail',\n  templateUrl: './listing-detail.component.html',\n  styleUrls: ['./listing-detail.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})], ListingDetailComponent);","map":{"version":3,"names":["Component","ChangeDetectionStrategy","Subject","takeUntil","tap","catchError","environment","ListingDetailComponent","constructor","route","router","listingService","cartService","notificationService","authService","destroy$","listing","selectedImage","isLoading","errorMessage","ngOnInit","params","pipe","subscribe","id","isNaN","loadListing","handleError","ngOnDestroy","next","complete","getListingById","photoUrls","length","mainPhotoUrl","error","message","show","console","setTimeout","navigate","getImageUrl","url","startsWith","apiUrl","split","selectImage","imageUrl","hasDescription","Boolean","description","trim","getDescription","getQualityClass","quality","toLowerCase","replace","addToCart","title","contactSeller","isLoggedIn","queryParams","returnUrl","userId","openImageModal","__decorate","selector","templateUrl","styleUrls","changeDetection","OnPush"],"sources":["C:\\Users\\leust\\source\\repos\\MPP-main\\Thrifto\\thrifto.client\\src\\app\\components\\listing-detail\\listing-detail.component.ts"],"sourcesContent":["// src/app/components/listing-detail/listing-detail.component.ts\r\nimport { Component, OnInit, OnDestroy, ChangeDetectionStrategy } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Subject } from 'rxjs';\r\nimport { takeUntil, tap, catchError } from 'rxjs/operators';\r\nimport { ListingService } from '../../services/listing.service';\r\nimport { CartService } from '../../services/cart.service';\r\nimport { NotificationService } from '../../services/notification.service';\r\nimport { AuthService } from '../../services/auth.service';\r\nimport { Listing } from '../../models/listing.model';\r\nimport { environment } from '../../../environments/environment';\r\n\r\n@Component({\r\n    selector: 'app-listing-detail',\r\n    templateUrl: './listing-detail.component.html',\r\n    styleUrls: ['./listing-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class ListingDetailComponent implements OnInit, OnDestroy {\r\n    private destroy$ = new Subject<void>();\r\n\r\n    listing: Listing | null = null;\r\n    selectedImage: string | null = null;\r\n    isLoading = true;\r\n    errorMessage = '';\r\n\r\n    constructor(\r\n        private route: ActivatedRoute,\r\n        private router: Router,\r\n        private listingService: ListingService,\r\n        private cartService: CartService,\r\n        private notificationService: NotificationService,\r\n        private authService: AuthService\r\n    ) { }\r\n\r\n    ngOnInit(): void {\r\n        this.route.params.pipe(\r\n            takeUntil(this.destroy$)\r\n        ).subscribe(params => {\r\n            const id = +params['id'];\r\n            if (!isNaN(id)) {\r\n                this.loadListing(id);\r\n            } else {\r\n                this.handleError('Invalid listing ID', null);\r\n            }\r\n        });\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        this.destroy$.next();\r\n        this.destroy$.complete();\r\n    }\r\n\r\n    private loadListing(id: number): void {\r\n        this.isLoading = true;\r\n\r\n        this.listingService.getListingById(id).pipe(\r\n            takeUntil(this.destroy$),\r\n            tap(listing => {\r\n                this.listing = listing;\r\n                if (listing?.photoUrls?.length) {\r\n                    this.selectedImage = listing.mainPhotoUrl || listing.photoUrls[0];\r\n                }\r\n                this.isLoading = false;\r\n            }),\r\n            catchError(error => {\r\n                this.handleError('Error loading listing details', error);\r\n                return [];\r\n            })\r\n        ).subscribe();\r\n    }\r\n\r\n    private handleError(message: string, error: any): void {\r\n        this.isLoading = false;\r\n        this.errorMessage = message;\r\n        this.notificationService.show(message, 'error');\r\n        console.error(message, error);\r\n\r\n        // Navigate to home after a delay\r\n        setTimeout(() => {\r\n            this.router.navigate(['/']);\r\n        }, 3000);\r\n    }\r\n\r\n    getImageUrl(url: string | null | undefined): string {\r\n        if (!url) {\r\n            return 'assets/images/placeholder.png';\r\n        }\r\n\r\n        if (url.startsWith('/')) {\r\n            return `${environment.apiUrl.split('/api')[0]}${url}`;\r\n        }\r\n\r\n        return url;\r\n    }\r\n\r\n    selectImage(imageUrl: string): void {\r\n        this.selectedImage = imageUrl;\r\n    }\r\n\r\n    hasDescription(): boolean {\r\n        return Boolean(\r\n            this.listing?.description &&\r\n            this.listing.description.trim().length > 0\r\n        );\r\n    }\r\n\r\n    getDescription(): string {\r\n        return this.listing?.description?.trim() || '';\r\n    }\r\n\r\n    getQualityClass(quality: string): string {\r\n        return quality.toLowerCase().replace(/\\s+/g, '-');\r\n    }\r\n\r\n    addToCart(): void {\r\n        if (!this.listing) return;\r\n\r\n        try {\r\n            this.cartService.addToCart(this.listing);\r\n            this.notificationService.show(\r\n                `${this.listing.title} added to cart successfully!`,\r\n                'success'\r\n            );\r\n        } catch (error) {\r\n            this.notificationService.show(\r\n                'Failed to add item to cart. Please try again.',\r\n                'error'\r\n            );\r\n        }\r\n    }\r\n\r\n    contactSeller(): void {\r\n        if (!this.listing) return;\r\n\r\n        if (!this.authService.isLoggedIn()) {\r\n            this.notificationService.show(\r\n                'Please login to contact the seller',\r\n                'info'\r\n            );\r\n            this.router.navigate(['/login'], {\r\n                queryParams: { returnUrl: this.router.url }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.router.navigate(['/chat', this.listing.userId]);\r\n    }\r\n\r\n    openImageModal(): void {\r\n        // TODO: Implement image modal/lightbox functionality\r\n        this.notificationService.show('Image zoom feature coming soon!', 'info');\r\n    }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}